# STELLAR üåü: A Structured Architecture for Reliable LLM Customer Support

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

Welcome to the official implementation of **STELLAR (Structured, Trustworthy, and Explainable LLM-Led Architecture for Reliable Customer Support)**! This repository contains the core code, experimental setup, and resources described in our upcoming paper [Link to Paper when available].

STELLAR addresses the critical challenges of reliability, explainability, and consistency when deploying Large Language Models (LLMs) for complex customer support tasks. Instead of relying on unpredictable monolithic LLMs or overly flexible agentic frameworks, STELLAR proposes a robust **Directed Acyclic Graph (DAG)** architecture.

<img src="STELLAR/images/complete_workflow_wobg.png?raw=true" alt="STELLAR Complete Workflow" width="450">
<br><em>(High-level overview of the STELLAR architecture in DAG, showing all modules and the possible transitions between them, which result in the 11 predefined workflows.)</em>

---

## üöÄ What is STELLAR?

STELLAR is a blueprint for building next-generation intelligent customer support systems. It leverages the power of LLMs within a structured, modular framework designed for:

*   ‚úÖ **Reliability & Predictability:** Enforced by the DAG structure and predefined workflows.
*   üîç **Explainability & Traceability:** Clear paths make debugging and auditing easier.
*   ‚öñÔ∏è **Balanced Integration:** Combines LLM innovation (classification, generation, verification) with practical needs (RAG, Human-in-the-Loop) and ethical safeguards (compliance checks).
*   üõ†Ô∏è **Modularity:** Composed of 9 distinct, specialized modules.
*   üìà **Continuous Improvement:** Features a semi-automatic knowledge base building loop.

---

## ‚ú® Key Features

*   **DAG Architecture:** Provides control, prevents infinite loops, and ensures predictable flow.
*   **9 Specialized Modules:** Each handles a specific task (Classification, RAG, Direct Info Retrieval, Escalation, Sentiment, Feedback, Knowledge Building, Verification, Compliance).
*   **11 Predefined Workflows:** Explicitly defined paths based on initial query type and runtime decisions.
*   **Multi-Pathway Design:** Efficiently routes queries to FAQ, Direct Info, or Human Escalation paths.
*   **LLM-Powered Innovation:** Uses LLMs for few-shot classification, re-ranking, context-aware verification, compliance checks, summarization, and draft generation.
*   **Practical Integration:** Incorporates Hybrid Search RAG (Module 2) and Human-in-the-Loop processes (Modules 4 & 7).
*   **Embedded Safety:** Includes robust compliance checking (Module 9) and user verification steps (Module 8).
*   **Semi-Automatic Improvement:** Module 7 facilitates knowledge base growth based on unresolved queries.
*   **Detailed Experimentation:** Includes code and data to reproduce module evaluations.

---

## üèóÔ∏è Architecture Overview

STELLAR's core is its DAG structure, orchestrating 9 distinct modules:

1.  **Inquiry Classifier:** Routes initial queries.
2.  **FAQ Retrieval (RAG):** Answers questions using a knowledge base.
3.  **Direct Information Retrieval:** Uses in-context learning for static data.
4.  **Human Support Escalation:** Manages handover to human agents, including urgency scoring.
5.  **Sentiment Analysis:** Gauges user sentiment.
6.  **Feedback Collector:** Gathers and categorizes user feedback.
7.  **Knowledge Base Builder:** Semi-automatically suggests new FAQs.
8.  **Interaction Verification:** Confirms resolution with the user contextually.
9.  **Compliance Checker:** Validates LLM responses before they reach the user.

The system follows one of 11 predefined workflows based on decisions at key branching points (Modules 1, 8, 9), ensuring controlled execution.

<img src="STELLAR/images/simplified_workflows.png?raw=true" alt="STELLAR Simplified Workflows" width="400">
<br><em>(Simplified illustration highlighting the three main initial paths (triggered by Module 1: Routing) and the role of Modules 8 (User Verification) and 9 (Compliance Verification) as key decision and flow divergence points)</em>

---

## üìÅ Repository Structure
```
‚îú‚îÄ‚îÄ README.md <-- You are here!
‚îî‚îÄ‚îÄ STELLAR/
‚îú‚îÄ‚îÄ STELLAR.ipynb <-- Main notebook to run/demonstrate STELLAR workflows
‚îú‚îÄ‚îÄ experiments/
‚îÇ ‚îú‚îÄ‚îÄ experiments.ipynb <-- Notebook to reproduce module evaluations
‚îÇ ‚îî‚îÄ‚îÄ test_cases/ <-- JSON files with test data for each module
‚îÇ ‚îî‚îÄ‚îÄ vector_databases/ <-- Pre-built ChromaDB instances for RAG experiments
‚îú‚îÄ‚îÄ human_agents/
‚îÇ ‚îî‚îÄ‚îÄ human_agents.json <-- Example roster of human agents for Module 4
‚îú‚îÄ‚îÄ images/ <-- Diagrams of the architecture and modules
‚îú‚îÄ‚îÄ logs/ <-- Directory for storing runtime workflow logs
‚îú‚îÄ‚îÄ outputs/ <-- Directory for outputs generated by modules (feedback, drafts, etc.)
‚îÇ ‚îú‚îÄ‚îÄ module_4/
‚îÇ ‚îú‚îÄ‚îÄ module_6/
‚îÇ ‚îú‚îÄ‚îÄ module_7/
‚îÇ ‚îî‚îÄ‚îÄ module_9/
‚îî‚îÄ‚îÄ requirements/ <-- Configuration files, prompts, and knowledge bases
‚îú‚îÄ‚îÄ module_1/ <-- Prompts for Classifier
‚îú‚îÄ‚îÄ module_2/ <-- FAQs, Prompts, Vector DB for RAG
‚îú‚îÄ‚îÄ module_3/ <-- Contact Info Corpus, Prompts for Direct Info
‚îú‚îÄ‚îÄ module_4/ <-- Weights, Prompts for Escalation
‚îú‚îÄ‚îÄ module_6/ <-- Configs, Prompts for Feedback
‚îú‚îÄ‚îÄ module_7/ <-- Prompts for KB Builder
‚îú‚îÄ‚îÄ module_8/ <-- Prompts for Verification
‚îî‚îÄ‚îÄ module_9/ <-- Prompts for Compliance
```

---

## ‚öôÔ∏è Getting Started

### Prerequisites

*   Python 3.8+
*   Jupyter Notebook or compatible environment
*   API Keys for LLM providers (e.g., Groq, OpenAI, Anthropic, hosted models via endpoints like Ollama/vLLM). By default, notebooks are configured to run using Groq. However, you can change this to use your preferred provider.

### Installation

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/Matheus-F-Scatolin/STELLAR.git
    cd STELLAR
    ```

### Running STELLAR

Open and run the `STELLAR/STELLAR.ipynb` notebook. This notebook will guide you through:
*   Loading the necessary configurations and modules.
*   Simulating user queries.
*   Observing how queries are processed through the different workflows based on module outputs.
*   Seeing the final outputs and generated logs.

### Running Experiments

Open and run the `STELLAR/experiments/experiments.ipynb` notebook. This notebook allows you to:
*   Load the test case data from `STELLAR/experiments/test_cases/`.
*   Run the evaluation functions for individual modules (1, 2, 3, 4, 5, 6, 9).
*   Reproduce the performance metrics reported in the paper.

---

## üß© Modules Deep Dive

Each module plays a specific role:

*   **Module 1:** Inquiry Classifier - Routes the query. <br> <img src="STELLAR/images/module_1.png?raw=true" alt="Module 1 Diagram" width="400">
*   **Module 2:** FAQ Retrieval (RAG) - Answers via RAG. <br> <img src="STELLAR/images/module_2.png?raw=true" alt="Module 2 Diagram" width="400">
*   **Module 3:** Direct Information Retrieval - Answers via In-Context Learning. <br> <img src="STELLAR/images/module_3.png?raw=true" alt="Module 3 Diagram" width="400">
*   **Module 4:** Human Support Escalation - Prepares for human agent. <br> <img src="STELLAR/images/module_4.png?raw=true" alt="Module 4 Diagram" width="400">
*   **Module 5:** Sentiment Analysis - Reads the mood. <br> <img src="STELLAR/images/module_5.png?raw=true" alt="Module 5 Diagram" width="400">
*   **Module 6:** Feedback Collector - Gathers user thoughts. <br> <img src="STELLAR/images/module_6.png" alt="Module 6 Diagram" width="400">
*   **Module 7:** Knowledge Base Builder - Suggests new FAQs. <br> <img src="STELLAR/images/module_7.png" alt="Module 7 Diagram" width="400">
*   **Module 8:** Interaction Verification - Confirms resolution. <br> <img src="STELLAR/images/module_8.png?raw=true" alt="Module 8 Diagram" width="400">
*   **Module 9:** Compliance Checker - Ensures safety & quality. <br> <img src="STELLAR/images/module_9.png?raw=true" alt="Module 9 Diagram" width="400">

---

## üìä Experiments

The `experiments/experiments.ipynb` notebook contains the code used to evaluate the performance of individual STELLAR modules as presented in our research. You can run this notebook to verify results using the provided test data in `experiments/test_cases/`.

---

## ü§ù Contributing

Contributions are welcome! If you find bugs or have suggestions for improvements, please open an issue or submit a pull request.

---

## üìú License

This project is licensed under the [MIT License](https://opensource.org/licenses/MIT). 

---

## üìÑ Citation

If you use STELLAR in your research or work, please cite our paper:

```bibtex
Not published yet : )
@article{-,
  title={STELLAR: A Structured, Trustworthy, and Explainable LLM-Led Architecture for Reliable Customer Support},
  author={-},
  journal={-},
  year={-}
}
```
